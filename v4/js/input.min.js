/*
	Advanced Custom Fields: Validated Field
	Justin Silver, http://justin.ag
	DoubleSharp, http://doublesharp.com
*/
var vf={valid:!1,$el:!1,reclick:!1,debug:!1,drafts:!0};"undefined"==typeof acf.o&&(acf.o={}),function(e){e(document).ready(function(){function t(t,i){function a(t,i,a){if(vf.valid=!0,t)for(var s=0;s<t.length;s++){var n=t[s];n.valid||(vf.valid=!1,msg=e("<div/>").html(n.message).text(),input=e('[name="'+n.id.replace("[","\\[").replace("]","\\]")+'"]'),input.closest(".validated-field").append('<span class="acf-error-message"><i class="bit"></i>'+msg+"</span>"),field=input.closest(".field"),field.addClass("error"),field.find(".widefat").css("width","100%"))}e("#ajax-loading").attr("style",""),e(".submitbox .spinner").hide(),e(".submitbox .button").removeClass("button-primary-disabled").removeClass("disabled"),vf.valid?vf.debug&&(vf.valid=confirm(vf_l10n.debug)):(i.before('<div id="acfvf_message" class="error"><p>'+vf_l10n.message+"</p></div>"),i.find(".field_type-validated_field .acf-error-message").show()),vf.valid&&a.trigger("click")}if(vf.valid=!1,!i)return!1;if("options"!=acf.o.post_id&&!vf.drafts&&"publish"!=i.attr("id"))return!0;var s=[];if(t.find(".field").not('[data-field_type="repeater"]').each(function(){var t=e(this);if(t.is(":hidden")){if(validate=!1,t.hasClass("acf-tab_group-hide")){var i=t.prevAll(".field_type-tab:first"),a=t.prevAll(".acf-tab-wrap:first");i.hasClass("acf-conditional_logic-hide")||($tab=a.find('.acf-tab-button[data-key="'+i.attr("data-field_key")+'"]'),validate=!0)}if(!validate)return}if(!t.hasClass("acf-conditional_logic-hide")&&!t.closest(".postbox.acf-hidden").exists()){var n=null;if(t.find(".acf_wysiwyg").exists()&&"object"==typeof tinyMCE){var r=t.find(".wp-editor-area").attr("id"),f=tinyMCE.get(r);s.push({id:t.find(".wp-editor-area").attr("name"),value:f.getContent()})}else if(t.find('.acf_relationship, input[type="radio"], input[type="checkbox"]').exists())sel='.acf_relationship .relationship_right input, input[type="radio"]:checked, input[type="checkbox"]:checked',n={id:t.find('input[type="hidden"], '+sel).attr("name"),value:[]},$inputs=t.find(sel),$inputs.length&&($inputs.each(function(){n.value.push(e(this).val())}),s.push(n));else{var d=t.find('input[type="text"], input[type="email"], input[type="number"], input[type="hidden"], textarea, select');d.exists()&&s.push({id:d.attr("name"),value:d.val()})}}}),e(".acf_postbox:hidden").remove(),s.length){var n="";return e("#profile-page").length?(post_id=e("#user_id").val(),n="user_"):post_id="options"==acf.o.post_id?"options":e(vf.frontend?"input[name=post_id]":"#post_ID").val(),e.ajax({url:ajaxurl,data:{action:"validate_fields",post_id:n+post_id,click_id:i.attr("id"),frontend:vf.frontend,fields:s},type:"POST",dataType:"json",success:function(e){a(e,t,i)},error:function(){a(s,t,i)}}),!1}return vf.valid=!0,!0}e("#profile-page").addClass("acf_postbox"),e('form.acf-form input[type="submit"]').addClass("button button-primary button-large");var a=acf.fields.tab.refresh;acf.fields.tab.refresh=function(){for(result=a.apply(this,arguments),i=0;i<arguments.length;i++)e(arguments[i]).trigger("acf/fields/tab/refresh",[arguments]);return result},inputSelector='input[type="text"], input[type="hidden"], textarea, select, input[type="checkbox"]:checked',e(document).on("change",inputSelector,function(){vf.valid=!1}),e(document).on("change, keypress, focus",inputSelector,function(){e(this).closest(".field").removeClass("error")}),e(document).on("click","form#post .button, form#post input[type=submit], form#your-profile input[type=submit], form.acf-form input[type=submit]",function(){vf.$el=e(this),vf.reclick&&(vf.reclick=!1,vf.$el.trigger("click"))}),e(document).on("submit","form#post, form#your-profile, form.acf-form",function(){return e(".field_type-validated_field").find(".acf-error-message").remove(),e(this).siblings("#acfvf_message, #message").remove(),acf.validation.status?vf.$el?vf.valid||t(e(this),vf.$el):(vf.reclick=!0,!1):!1})})}(jQuery);